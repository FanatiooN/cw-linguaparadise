<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ru">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö—É—Ä—Å—ã | LanguaParadise</title>
    <link href="/static/css/minimal.css" rel="stylesheet">
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <a href="/" class="logo">LanguaParadise</a>
                <nav class="nav">
                    <a href="/courses">–ö—É—Ä—Å—ã</a>
                    <a href="/person">–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</a>
                    <a href="/korzina">–ö–æ—Ä–∑–∏–Ω–∞</a>
                    <a href="/logout">–í—ã—Ö–æ–¥</a>
                </nav>
            </div>
        </div>
    </header>

    <main>
        <div class="container">
            <h1>–ö–∞—Ç–∞–ª–æ–≥ –∫—É—Ä—Å–æ–≤</h1>

            <div th:if="${#authentication.principal != null and #authentication.principal.user != null and #authentication.principal.user.role != null and #authentication.principal.user.role.name() == 'ADMIN'}" class="mb-4">
                <button class="btn btn-primary" onclick="showCreateCourseModal()">
                    –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –∫—É—Ä—Å
                </button>
            </div>

            <div class="courses-grid">
                <div class="course-card" th:each="cours : ${coursList}">
                    <div class="course-avatar" style="margin-bottom: 1rem;">
                        <div th:if="${cours.avatar == null}" class="avatar-placeholder" 
                             style="width: 100%; height: 150px; background: var(--light-gray); border-radius: var(--border-radius); display: flex; align-items: center; justify-content: center; font-size: 3rem; color: var(--accent);">
                            üìö
                        </div>
                        <img th:if="${cours.avatar != null}" th:src="${cours.avatar}" alt="–ê–≤–∞—Ç–∞—Ä –∫—É—Ä—Å–∞" 
                             style="width: 100%; height: 150px; object-fit: cover; border-radius: var(--border-radius);">
                    </div>
                    
                    <h3 class="course-title" th:text="${cours.name}">–ù–∞–∑–≤–∞–Ω–∏–µ –∫—É—Ä—Å–∞</h3>
                    <div class="course-price" th:text="${cours.coursPrice} + '‚ÇΩ'">–¶–µ–Ω–∞</div>
                    <p class="course-description" th:text="${cours.description}">–û–ø–∏—Å–∞–Ω–∏–µ –∫—É—Ä—Å–∞</p>
                    <button class="btn btn-primary btn-block add-to-cart-btn"
                            th:data-id="${cours.id}"
                            th:data-name="${cours.name}"
                            th:data-price="${cours.coursPrice}"
                            th:data-description="${cours.description}"
                            th:data-avatar="${cours.avatar}">
                        –î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É
                    </button>
                </div>
            </div>

            <div th:if="${#lists.isEmpty(coursList)}" class="text-center mt-4">
                <div class="card">
                    <h3>–ö—É—Ä—Å—ã –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã</h3>
                    <p class="text-muted">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ –∏–ª–∏ —Å–≤—è–∂–∏—Ç–µ—Å—å —Å –Ω–∞–º–∏.</p>
                </div>
            </div>
        </div>
    </main>

    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>–û –Ω–∞—Å</h3>
                    <p class="text-muted">
                        LanguaParadise ‚Äî —Ä–∞–∑—Ä—É—à–∞–µ–º —è–∑—ã–∫–æ–≤—ã–µ –±–∞—Ä—å–µ—Ä—ã —Å –∫–æ–º—Ñ–æ—Ä—Ç–æ–º!
                    </p>
                </div>
                <div class="footer-section">
                    <h3>–ù–∞–≤–∏–≥–∞—Ü–∏—è</h3>
                    <ul>
                        <li><a href="/courses">–ö—É—Ä—Å—ã</a></li>
                        <li><a href="/person">–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</a></li>
                        <li><a href="/korzina">–ö–æ—Ä–∑–∏–Ω–∞</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h3>–ö–æ–Ω—Ç–∞–∫—Ç—ã</h3>
                    <ul>
                        <li>–ò–ö–ë–û-36-22</li>
                        <li>–ù–∞–∑–∏—Ä–æ–≤ –§. –§.</li>
                        <li><a href="mailto:nazirov.f.f@gmail.com">nazirov.f.f@gmail.com</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </footer>

    <div id="createCourseModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –∫—É—Ä—Å</h3>
                <span class="close" onclick="closeModal('createCourseModal')">&times;</span>
            </div>
            <div class="modal-body">
                <form id="createCourseForm">
                    <div class="form-group">
                        <label class="form-label" for="courseName">–ù–∞–∑–≤–∞–Ω–∏–µ –∫—É—Ä—Å–∞</label>
                        <input type="text" id="courseName" class="form-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫—É—Ä—Å–∞" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="coursePrice">–¶–µ–Ω–∞ (‚ÇΩ)</label>
                        <input type="number" id="coursePrice" class="form-input" min="0" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ü–µ–Ω—É" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="courseDescription">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                        <textarea id="courseDescription" class="form-input" rows="4" placeholder="–í–≤–µ–¥–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∫—É—Ä—Å–∞" required></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="courseAvatar">–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫—É—Ä—Å–∞</label>
                        <input type="file" id="courseAvatar" accept="image/*" class="form-input" onchange="handleCourseAvatarChange(event)">
                        <div id="courseAvatarPreview" style="margin-top: 1rem; display: none;">
                            <img id="courseAvatarImg" style="max-width: 200px; max-height: 150px; border-radius: var(--border-radius);">
                        </div>
                    </div>
                    <div class="modal-actions">
                        <button type="button" class="btn btn-primary" onclick="createCourse()">–°–æ–∑–¥–∞—Ç—å –∫—É—Ä—Å</button>
                        <button type="button" class="btn btn-secondary" onclick="closeModal('createCourseModal')">–û—Ç–º–µ–Ω–∞</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        let courseAvatarBase64 = null;
        
        let cart = JSON.parse(localStorage.getItem('cart')) || [];

        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('.add-to-cart-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const id = parseInt(this.dataset.id);
                    const name = this.dataset.name;
                    const price = parseInt(this.dataset.price);
                    const description = this.dataset.description;
                    const avatar = this.dataset.avatar === 'null' ? null : this.dataset.avatar;
                    
                    addToCart(id, name, price, description, avatar);
                });
            });
        });

        function addToCart(id, name, price, description, avatar) {
            const existingItem = cart.find(item => item.id === id);
            if (existingItem) {
                showNotification('–ö—É—Ä—Å —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∫–æ—Ä–∑–∏–Ω—É', 'warning');
                return;
            }

            const course = {
                id: id,
                name: name,
                price: price,
                description: description,
                avatar: avatar
            };

            cart.push(course);
            localStorage.setItem('cart', JSON.stringify(cart));
            showNotification('–ö—É—Ä—Å –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∫–æ—Ä–∑–∏–Ω—É!', 'success');
        }

        function showCreateCourseModal() {
            document.getElementById('createCourseModal').style.display = 'flex';
        }

        function handleCourseAvatarChange(event) {
            const file = event.target.files[0];
            if (file) {
                if (file.size > 5 * 1024 * 1024) {
                    showNotification('–†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ –Ω–µ –¥–æ–ª–∂–µ–Ω –ø—Ä–µ–≤—ã—à–∞—Ç—å 5MB', 'error');
                    return;
                }

                if (!file.type.startsWith('image/')) {
                    showNotification('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ', 'error');
                    return;
                }

                const reader = new FileReader();
                reader.onload = function(e) {
                    courseAvatarBase64 = e.target.result;
                    
                    const preview = document.getElementById('courseAvatarPreview');
                    const img = document.getElementById('courseAvatarImg');
                    img.src = courseAvatarBase64;
                    preview.style.display = 'block';
                };
                reader.readAsDataURL(file);
            }
        }

        function createCourse() {
            const name = document.getElementById('courseName').value;
            const price = document.getElementById('coursePrice').value;
            const description = document.getElementById('courseDescription').value;

            if (!name || !price || !description) {
                showNotification('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è', 'error');
                return;
            }

            const courseData = {
                name: name,
                coursPrice: price,
                description: description,
                avatar: courseAvatarBase64
            };

            fetch('/api/courses/create', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(courseData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showNotification('–ö—É—Ä—Å —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω!', 'success');
                    closeModal('createCourseModal');
                    setTimeout(() => {
                        window.location.reload();
                    }, 1000);
                } else {
                    showNotification(data.message || '–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∫—É—Ä—Å–∞', 'error');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showNotification('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º', 'error');
            });
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
            if (modalId === 'createCourseModal') {
                document.getElementById('createCourseForm').reset();
                document.getElementById('courseAvatarPreview').style.display = 'none';
                courseAvatarBase64 = null;
            }
        }

        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.className = `notification notification-${type}`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.classList.add('show');
            }, 100);
            
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }

        window.onclick = function(event) {
            const modal = document.getElementById('createCourseModal');
            if (event.target === modal) {
                closeModal('createCourseModal');
            }
        }
    </script>
</body>
</html> 